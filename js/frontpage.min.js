/*!
 * yellr-web v0.0.1 (http://yellr.net)
 * Copyright 2014-2015 hhroc
 * Licensed under MIT (https://github.com/hhroc/yellr-web/blob/master/LICENSE)
 */

!function(a,b,c){"use strict";b.yellr={tag:"Yellr Frontpage",modules:{},UUID:0,BASE_URL:"http://yellr.net/",URLS:{},SETTINGS:{lat:47,lng:40,language:{code:"en"}},init:function(){console.log(this.tag);for(var b in this.modules)this.modules[b].init();this.UUID=this.utils.guid(),console.log("UUID created: ",this.UUID),this.URLS.assignments=this.BASE_URL+"get_assignments.json?client_id="+this.UUID+"&language_code="+yellr.SETTINGS.language.code+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng,this.URLS.notifications=this.BASE_URL+"get_notifications.json?client_id="+this.UUID,this.URLS.messages=this.BASE_URL+"get_messages.json?client_id="+this.UUID,this.URLS.stories=this.BASE_URL+"get_stories.json?client_id="+this.UUID+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng+"&language_code="+yellr.SETTINGS.language.code,this.URLS.profile=this.BASE_URL+"todo",this.URLS.upload=this.BASE_URL+"upload_media.json",this.URLS.post=this.BASE_URL+"publish_post.json",this.URLS.server_info=this.BASE_URL+"server_info.json",this.URLS.send_message=this.BASE_URL+"create_response_message.json",console.log(this.URLS),console.log(this.SETTINGS),a("#submit-tip").click(function(){console.log("get all the forms")}),a("#textarea").keydown(function(b){a("#display").text((b.metaKey||b.ctrlKey)&&13==b.keyCode)})},utils:{guid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=d,f=[];if(b=b||e.length,a)for(c=0;a>c;c++)f[c]=e[0|Math.random()*b];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",c=0;36>c;c++)f[c]||(g=0|16*Math.random(),f[c]=e[19==c?3&g|8:g])}return f.join("")}}},a(c).ready(function(){a(c).foundation(),yellr.init()})}($,window,window.document),function(a,b,c){"use strict";yellr.modules.submit={tag:"submit.js",init:function(){console.log(this.tag),this.$forms=a(".submit-form")},submit_form:function(){var b=c.querySelectorAll(".forms-wrapper form"),d=0,e=[];console.log(b.length);for(var f=0;f<b.length;f++){var g=b[f];console.log(f,g),yellr.utils.validate_form(g)?a(g).ajaxSubmit({url:yellr.URLS.upload,data:{client_id:yellr.UUID},success:function(a){a.success?(d++,e.push(a.media_id),d===b.length&&yellr.utils.publish_post(e,function(){yellr.utils.render_template({template:"#text-form-template",target:".forms-wrapper"})})):(console.log("Something went wrong with upload_media..."),console.log(a))},clearForm:!0}):d++}},validate_form:function(a){var b=!1;return"text-form"===a.id?""!==a.querySelector("textarea").value?b=!0:yellr.utils.notify("The text form is empty."):a.querySelector('input[name="media_file"]').value?b=!0:yellr.utils.notify("Missing media file."),b},publish_post:function(b,c){a.post(yellr.URLS.post,{title:"Web Submission",client_id:yellr.UUID,assignment_id:null,language_code:yellr.SETTINGS.language.code,lat:yellr.SETTINGS.lat,lng:yellr.SETTINGS.lng,media_objects:JSON.stringify(b)},function(){console.log("post published"),yellr.UUID=yellr.utils.guid(),yellr.utils.save()}).done(function(){c&&c()})}}}($,window,window.document),function(a){"use strict";yellr.modules.server={tag:"server",init:function(){console.log(this.tag)},get_assignments:function(){console.log("get_assignments"),a.getJSON(yellr.URLS.assignments,function(a){console.log(a),a.success||console.log("lol")}).done(function(){console.log("done")})}}}($,window,window.document);